<div class="coupon-section" id="coupon-{{ section.id }}" data-section-id="{{ section.id }}">

  {% if section.settings.full_width %}<div class="gridlock-fluid"><div class="row">{% endif %}

  <div class="row no-fouc">
    {% comment %} THE LOOP {% endcomment %}

    {% for block in section.blocks %}

    {% case block.settings.coupon_color %}
    {% when "medium" %}
    {%- assign color_class = "medium-gray" -%}
    {% when "light" %}
    {%- assign color_class = "light-gray" -%}
    {% when "white" %}
    {%- assign color_class = "white" -%}
    {% endcase %}

    <div class="coupon {{ color_class }} promo-{{ block.id }}" {{ block.shopify_attributes }}>

      {% comment %} TEXT {% endcomment %}
      <div class="coupon-content">
        {% if block.settings.heading_text != blank %}
        <h3>{{ block.settings.heading_text | escape }}</h3>
        {% endif %}
        {% if block.settings.text != blank %}
        <div class="copy">{{ block.settings.text }}</div>
        {% endif %}

        {% comment %} CTA {% endcomment %}
        {% if block.settings.cta_text != blank %}
        <div class="cta">
          {% if block.settings.link != blank %}<a href="{{ block.settings.link }}">{% endif %}
            <span>{{ block.settings.cta_text }}</span>
          {% if block.settings.link != blank %}</a>{% endif %}
        </div>
        {% endif %}

        <div class="details">
          {% if block.settings.details_text != blank %}
            <label for="details">Details</label>
            <div class="additional">{{ block.settings.details_text }}</div>
          {% endif %}
        </div>
      </div>

    </div>
    {% endfor %}

    {% comment %} END LOOP {% endcomment %}
  </div>

  <script>
    $(document).ready(function(){
      $('.coupon-section .coupon .details label').on('click',function(e){
        if (e.handled !== true) {
          $(this).next('div').slideToggle().toggleClass('open');
          e.handled = true;
        }
      });
    });
  </script>
  {% if section.settings.full_width %}</div></div>{% endif %}

  {% if section.blocks.size == 0 %}
  {% include 'no-blocks' %}
  {% endif %}

</div>
<div class="clear"></div>

{% schema %}
{
  "name": "Coupon",
  "max_blocks": 1,
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Enable full width"
    }    
  ],
  "blocks": [
    {
      "type": "text_block",
      "name": "Coupon",
      "settings": [
        {
          "type": "text",
          "id": "heading_text",
          "label": "Heading",
          "default": "Our collections"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Pair large text with an image to give focus to your chosen product, collection, or blog post.</p>"
        },
        {
          "type": "text",
          "id": "cta_text",
          "label": "CTA Text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "link",
          "label": "CTA Link",
          "info": "Optional"
        },
        {
          "type": "richtext",
          "id": "details_text",
          "label": "Details Text",
          "default": "<p>Place relevant promotional details or disclaimers here.</p>"
        },
        {
          "type": "select",
          "id": "coupon_color",
          "label": "Background Color",
          "info": "Choose a color for the background of the coupon box",
          "options": [
            {
              "value": "medium",
              "label": "Medium Gray"
            },
            {
              "value": "light",
              "label": "Light Gray"
            },
            {
              "value": "white",
              "label": "White"
            }
          ] 
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Coupon",
      "category": "Promotional",
      "blocks": [
        {
          "type": "text_block"
        }
      ]
    }
  ]
}
{% endschema %}
